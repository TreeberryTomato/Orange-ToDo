<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!--layui css-->
    <link rel="stylesheet" type="text/css" href="https://www.layuicdn.com/layui-v2.5.6/css/layui.css" />
    
    <title>ToDo</title>
</head>

<body>
    <div class="layui-fluid">

        <div class="layui-row">

            <!--放置结果-->
            <div class="layui-col-md10 layui-col-md-offset1" style="margin-top: 40px;">

                <table class="layui-table">
                    <colgroup>
                      <col width="400">
                      <col width="400">
                      <col width="400">
                      <col>
                    </colgroup>

                    <thead>
                      <tr>
                        <th>Content</th>
                        <th>CreateDateTime</th>
                        <th>DeadLine</th>
                        <th>IsDone</th>
                        <th>Action</th>
                      </tr> 
                    </thead>

                    <!--这里放置任务内容，创建时间，截止日期和是否完成-->
                    <tbody id="tasksTable">

                    </tbody>
                  </table>
            </div>

            <div class="layui-col-md2 layui-col-md-offset5" style="margin-top: 40px;">
                <button onclick="getList()">
                    获取任务列表
                </button>
            </div>
        </div>
    </div>



    <!--layui javascript-->
    <script src="https://www.layuicdn.com/layui-v2.5.6/layui.js"></script>

    <script>
        function getinfo(url){
            return new Promise( function(resolve, reject){
                var xhr = new XMLHttpRequest();
                xhr.open('get',url,true);

                xhr.responseType ='json';
                xhr.onload =  function(){
                    var status = xhr.status;
                    if (status == 200) {
                        resolve(xhr.response);
                    } else {
                        alert(status);
                        reject(status);
                    }
                };
                xhr.send();
            });
        };
        function getList()
        {
            var url= "http://localhost:8080/v1/taskinfo/";

            getinfo(url).then( function(tasks){
                var tasksTable = document.getElementById("tasksTable");

                //每次读取的时候清空保留在页面上的记录
                tasksTable.innerHTML="";

                for(var i in tasks)
                {
                    var taskOBJ = document.createElement("tr");

                    var Content = tasks[i].Content;
                    var CreateDateTime = new Date(tasks[i].CreateDateTime);
                    var DeadLine = new Date(tasks[i].DeadLine);
                    var IsDone = tasks[i].IsDone;

                    taskOBJ.innerHTML = 
                    `
                    <td id="Content">
                        ${Content}
                    </td>

                    <td id="CreateDateTime">
                        ${CreateDateTime}
                    </td>

                    <td id="DeadLine">
                        ${DeadLine}
                    </td>

                    <td id="IsDone">
                        ${IsDone}
                    </td>
                    <td id="Action">
                        <button id="task_${i}" onclick="delete()">
                            Delete
                        </button>
                    </td>
                    `

                    tasksTable.appendChild(taskOBJ);
                }
            }, function(status) {
                alert('Something went wrong.');
            });
        }
    </script>


   
</body>
</html>
